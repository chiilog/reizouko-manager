# FoodForm.test.tsx リファクタリング方針

## 1. はじめに

`src/components/FoodForm.test.tsx` は、`FoodForm` コンポーネントの単体テストファイルです。現在、テストケースが増加し、ファイル全体が肥大化しているため、可読性および保守性の向上が求められます。

このドキュメントでは、当該テストファイルのリファクタリング方針を定義します。

## 2. 現状の課題

- **テストケースの重複**: 同様の初期状態やアサーションを持つテストが散見されます。特に、フォーム送信成功時の `onFoodAdded` と `onClose` の呼び出し確認は複数のテストで行われています。
- **テストの粒度**: 一部のテストケースでは、複数の異なる振る舞いを一度に検証しようとしている可能性があります。
- **`describe` ブロックの構成**: 「食品名入力のバリデーション」と「フォームバリデーション」など、関連性の高い、あるいは重複する可能性のある `describe` ブロックが存在します。
- **可読性の低下**: テストケースの増加に伴い、全体の把握が難しくなりつつあります。

## 3. リファクタリング方針

### 3.1. 重複テストの統合

#### 3.1.1. `onFoodAdded` と `onClose` の呼び出し確認

複数のテストケースで、フォーム送信成功時に `onFoodAdded` と `onClose` プロップスが呼び出されることを確認しています。これらは `it.each` を使用して、異なる入力値やシナリオでまとめてテストすることを検討します。

**例:**

```typescript
// 現状の重複している可能性のあるテスト
it('フォーム送信時に正しい処理が行われることを確認', async () => {
  // ...
  await waitFor(() => {
    expect(mockProps.onFoodAdded).toHaveBeenCalled();
    expect(mockProps.onClose).toHaveBeenCalled();
  });
});

it('ユーザー操作を使って食材を追加できることを確認', async () => {
  // ...
  expect(mockProps.onFoodAdded).toHaveBeenCalledTimes(1);
  expect(mockProps.onClose).toHaveBeenCalledTimes(1);
});

it('食材追加成功時にonFoodAddedとonCloseが呼ばれることを確認', async () => {
  // ...
  await waitFor(() => {
    expect(mockProps.onFoodAdded).toHaveBeenCalledTimes(1);
    expect(mockProps.onClose).toHaveBeenCalledTimes(1);
  });
});
```

これらのテストは、入力値やモックの設定が若干異なる可能性がありますが、主要なアサーションは共通しています。
`it.each` を使用し、テストデータ（入力値、期待される `addFoodItem` の引数など）をパラメータ化することで、1つのテストケースに統合できる可能性があります。

### 3.2. テストの粒度の見直し

各 `it` ブロックが単一の責任を持つように見直します。複数のアサーションが混在し、テストの意図が曖昧になっている場合は、より小さなテストケースに分割することを検討します。

- **例**: 「フォームの要素が正しく表示されることを確認」テストは、ダイアログタイトル、各入力フィールド、ボタンの表示をまとめて検証していますが、これは許容範囲と考えられます。しかし、これ以上に多くの要素や状態を1つのテストで検証している場合は分割を検討します。

### 3.3. `describe` ブロックの整理と明確化

関連性の高いテストグループを適切に `describe` でまとめ、ネスト構造を整理します。

- **「食品名入力のバリデーション」と「フォームバリデーション」**:
  これらの `describe` ブロックは内容が重複している、または密接に関連しているように見受けられます。
  例えば、「食品名が空の場合はエラーが表示されることを確認」というテストは両方の `describe` ブロック内に存在します。
  これらを統合し、より意味のあるグルーピング（例: `describe('入力バリデーション', () => { ... });` の下に、各フィールドごとの `describe` を配置するなど）を検討します。

### 3.4. 不要なテストの検討

他のテストで十分にカバーされている、あるいはコンポーネントの核心的な機能とは言い難いテストについては、削除または統合を検討します。ただし、どのテストが「不要」であるかの判断は慎重に行い、コンポーネントの振る舞いを網羅的にテストするという目的を損なわないようにします。

- **例**: 70行目付近の「フォーム送信時に正しい処理が行われることを確認」と124行目付近の「ユーザー操作を使って食材を追加できることを確認」は、アサーションの内容が近いため、どちらか一方に集約できるか、あるいはより明確に目的を分離できないか検討します。

## 4. 期待される効果

- **可読性の向上**: テストの意図が明確になり、コードが追いやすくなります。
- **保守性の向上**: 重複コードの削減により、仕様変更時の修正箇所が減り、メンテナンスコストが低減します。
- **実行効率の改善**: 不要なテストの削除や効率的なテスト構造により、テスト実行時間が短縮される可能性があります（ただし、これが主目的ではありません）。

## 5. 今後のステップ

1.  上記方針に基づき、`FoodForm.test.tsx` の具体的な修正案を作成します。
2.  修正案についてレビューを受け、合意を得ます。
3.  実際にコードの修正作業を行います。
4.  リファクタリング後のテストが全てパスすることを確認します。
5.  変更内容をコミットします（指示がある場合）。
